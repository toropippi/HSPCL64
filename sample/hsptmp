#include "HSPCL64.as"

	//_ExHCLSetCommandQueueMax 2
	HCLinit
	HCLSetDev 2
	HCLSetCommandQueue 0
	prg=HCLCreateProgram("kern.cl")
	krn=HCLCreateKernel(prg,"vecAdd")
	n=256
	clmemm=HCLCreateBuffer(n*4)

	dim inta,n
	dim inta2,n
		repeat n
		inta.cnt=cnt+1
		loop
	HCLWriteBuffer clmemm,inta,n*4,0,0
	HCLSetKernel krn,0,clmemm

	repeat 1024
		repeat 10000
		HCLDoKrn1 krn,n,n
		loop
	wait 10
	if cnt\16==15{
		HCLinit:HCLSetDev 2
		HCLSetCommandQueue 0
		prg=HCLCreateProgram("kern.cl")
		krn=HCLCreateKernel(prg,"vecAdd")
		n=256
		clmemm=HCLCreateBuffer(n*4)
		HCLSetKernel krn,0,clmemm
	}
	loop
	
	end

/*
	HCLSetCommandQueue 0
	HCLReadBuffer clmemm,inta2,n*4,0,0,0
	mes "1+1="+inta2.0
	mes "2+2="+inta2.1
	mes "3+3="+inta2.2
	mes "4+4="+inta2.3
	wait 100
*/